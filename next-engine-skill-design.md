# ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³è¨­å®šè‡ªå‹•åŒ–ã‚¹ã‚­ãƒ« è¨­è¨ˆæ›¸

## 1. æ¦‚è¦

### ç›®çš„
ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ECé‹ç”¨ã«ãŠã‘ã‚‹è¨­å®šä½œæ¥­ã‚’è‡ªå‹•åŒ–ã—ã€åŠ¹ç‡åŒ–ã‚’å›³ã‚‹ã€‚

### å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ 
- **ã‚µãƒ¼ãƒ“ã‚¹å**: ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ (Next Engine)
- **APIä»•æ§˜**: [Next Engine Developer Network](https://developer.next-engine.com/)
- **å¯¾å¿œãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2025å¹´ç‰ˆAPIï¼ˆå•†å“ã‚³ãƒ¼ãƒ‰é€£æºå¯¾å¿œï¼‰

### è‡ªå‹•åŒ–å¯¾è±¡
1. **å•†å“ãƒã‚¹ã‚¿è¨­å®š**
   - å•†å“ç™»éŒ²ãƒ»æ›´æ–°
   - ã‚«ãƒ†ã‚´ãƒªè¨­å®š
   - å•†å“ã‚³ãƒ¼ãƒ‰é€£æº
   - ä¸€æ‹¬æ›´æ–°å‡¦ç†

2. **åœ¨åº«ç®¡ç†è¨­å®š**
   - åœ¨åº«æ•°æ›´æ–°
   - åœ¨åº«é€£æºè¨­å®š
   - åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
   - å€‰åº«åˆ¥åœ¨åº«ç®¡ç†

3. **ç™ºé€ãƒ»é…é€è¨­å®š**
   - é…é€æ¥­è€…è¨­å®š
   - é…é€æ–¹æ³•ãƒãƒƒãƒ”ãƒ³ã‚°
   - é€ã‚ŠçŠ¶ç™ºè¡Œè¨­å®š
   - è¿½è·¡ç•ªå·ç™»éŒ²

---

## 2. æ—¢å­˜ãƒ¢ãƒ¼ãƒ«é‹ç”¨ç’°å¢ƒã®è€ƒæ…®äº‹é …

### 2.1 å‰ææ¡ä»¶

æœ¬ã‚¹ã‚­ãƒ«ã¯ã€ä»¥ä¸‹ã®ECãƒ¢ãƒ¼ãƒ«ã§**æ—¢ã«é‹ç”¨ä¸­**ã®åº—èˆ—ãŒãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’å°å…¥ã™ã‚‹å ´åˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ï¼š

| ãƒ¢ãƒ¼ãƒ« | å•†å“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  | å•†å“ã‚³ãƒ¼ãƒ‰ä½“ç³» | åœ¨åº«ç®¡ç† |
|--------|---------------|--------------|---------|
| **æ¥½å¤©å¸‚å ´** | RMS (Rakuten Merchant Server) | å•†å“ç®¡ç†ç•ªå·ï¼ˆä»»æ„è¨­å®šï¼‰ | ãƒ¢ãƒ¼ãƒ«åˆ¥åœ¨åº« |
| **Amazon** | ã‚»ãƒ©ãƒ¼ã‚»ãƒ³ãƒˆãƒ©ãƒ« | ASIN + SKU | FBA/è‡ªç¤¾å‡ºè· |
| **Qoo10** | Qoo10 Seller Office | Qoo10å•†å“ç•ªå· | ãƒ¢ãƒ¼ãƒ«åˆ¥åœ¨åº« |
| **Yahoo!ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°** | ã‚¹ãƒˆã‚¢ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼Pro | ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆID | ãƒ¢ãƒ¼ãƒ«åˆ¥åœ¨åº« |

### 2.2 ä¸»è¦ãªèª²é¡Œã¨å¯¾ç­–

#### 2.2.1 å•†å“ã‚³ãƒ¼ãƒ‰çµ±ä¸€ã®èª²é¡Œ

**èª²é¡Œ:**
å„ãƒ¢ãƒ¼ãƒ«ã§ç•°ãªã‚‹å•†å“ã‚³ãƒ¼ãƒ‰ä½“ç³»ãŒä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã®çµ±åˆç®¡ç†ãŒå›°é›£ã€‚

**ä¾‹:**
```
åŒä¸€å•†å“ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ï¼š
- æ¥½å¤©: rakuten-prod-001
- Amazon: B08XXXXX (ASIN), seller-sku-001 (SKU)
- Qoo10: 12345678
- Yahoo: yahoo-prod-001
- ç¤¾å†…ç®¡ç†ã‚³ãƒ¼ãƒ‰: MASTER-001
```

**å¯¾ç­–:**

1. **ãƒã‚¹ã‚¿ãƒ¼å•†å“ã‚³ãƒ¼ãƒ‰ä½“ç³»ã®è¨­è¨ˆ**
   ```yaml
   # product-mapping.yaml
   master_products:
     - master_code: "MASTER-001"           # ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³çµ±ä¸€ã‚³ãƒ¼ãƒ‰
       internal_sku: "SKU-TSHIRT-BLK-M"    # ç¤¾å†…SKU
       jan_code: "4901234567890"           # JANã‚³ãƒ¼ãƒ‰ï¼ˆã‚ã‚Œã°ï¼‰

       # ãƒ¢ãƒ¼ãƒ«åˆ¥å•†å“ã‚³ãƒ¼ãƒ‰
       mall_mappings:
         rakuten:
           product_code: "rakuten-prod-001"
           variant_code: "rakuten-var-001"
         amazon:
           asin: "B08XXXXX"
           seller_sku: "seller-sku-001"
         qoo10:
           product_number: "12345678"
           seller_code: "qoo10-sku-001"
         yahoo:
           product_id: "yahoo-prod-001"
   ```

2. **å•†å“ã‚³ãƒ¼ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ§‹ç¯‰**
   ```typescript
   // src/services/product-mapping-service.ts

   interface ProductMapping {
     masterCode: string;          // ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³çµ±ä¸€ã‚³ãƒ¼ãƒ‰
     internalSku: string;         // ç¤¾å†…SKU
     janCode?: string;            // JANã‚³ãƒ¼ãƒ‰
     mallMappings: {
       rakuten?: {
         productCode: string;
         variantCode?: string;
       };
       amazon?: {
         asin: string;
         sellerSku: string;
       };
       qoo10?: {
         productNumber: string;
         sellerCode?: string;
       };
       yahoo?: {
         productId: string;
       };
     };
   }

   class ProductMappingService {
     // ãƒ¢ãƒ¼ãƒ«å•†å“ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒã‚¹ã‚¿ãƒ¼å•†å“ã‚³ãƒ¼ãƒ‰ã¸ã®å¤‰æ›
     async getMasterCode(
       mall: 'rakuten' | 'amazon' | 'qoo10' | 'yahoo',
       mallProductCode: string
     ): Promise<string | null> {
       // ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰æ¤œç´¢
     }

     // ãƒã‚¹ã‚¿ãƒ¼å•†å“ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å„ãƒ¢ãƒ¼ãƒ«ã®å•†å“ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
     async getMallCodes(masterCode: string): Promise<MallCodes> {
       // ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—
     }
   }
   ```

#### 2.2.2 å•†å“æƒ…å ±ã®å·®ç•°ç®¡ç†

**èª²é¡Œ:**
å„ãƒ¢ãƒ¼ãƒ«ã§å•†å“åã€èª¬æ˜æ–‡ã€ä¾¡æ ¼ã€ç”»åƒãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚‹ã€‚

**å…·ä½“ä¾‹:**
| é …ç›® | æ¥½å¤© | Amazon | Qoo10 | Yahoo |
|------|------|--------|-------|-------|
| å•†å“å | ã€é€æ–™ç„¡æ–™ã€‘ãƒ¡ãƒ³ã‚ºTã‚·ãƒ£ãƒ„ é»’ Mã‚µã‚¤ã‚º | ãƒ¡ãƒ³ã‚ºTã‚·ãƒ£ãƒ„ ãƒ–ãƒ©ãƒƒã‚¯ M | Men's T-Shirt Black M | ãƒ¡ãƒ³ã‚ºTã‚·ãƒ£ãƒ„ï¼ˆé»’ãƒ»Mï¼‰ |
| ä¾¡æ ¼ | 2,980å†† | 2,780å†† | 2,680å†† | 2,880å†† |
| èª¬æ˜æ–‡ | æ¥½å¤©é™å®šã‚»ãƒƒãƒˆå†…å®¹ã‚’å«ã‚€ | Amazonå‘ã‘ç°¡æ½”ç‰ˆ | éŸ“å›½èªæ··åœ¨ | Yahooå‘ã‘ |

**å¯¾ç­–:**

1. **ãƒ¢ãƒ¼ãƒ«åˆ¥å•†å“å±æ€§ã®ç®¡ç†**
   ```yaml
   # product-config.yaml
   products:
     source:
       type: csv
       path: ./data/products-multi-mall.csv

     # ãƒ¢ãƒ¼ãƒ«åˆ¥å±æ€§ãƒãƒƒãƒ”ãƒ³ã‚°
     mall_specific_attributes:
       enabled: true

       # å…±é€šå±æ€§ï¼ˆãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ãƒã‚¹ã‚¿ãƒ¼ï¼‰
       common:
         - master_code
         - internal_sku
         - jan_code
         - base_price
         - stock

       # ãƒ¢ãƒ¼ãƒ«å›ºæœ‰å±æ€§
       rakuten:
         - rakuten_product_name      # æ¥½å¤©å•†å“å
         - rakuten_price             # æ¥½å¤©ä¾¡æ ¼
         - rakuten_description       # æ¥½å¤©èª¬æ˜æ–‡
         - rakuten_image_urls        # æ¥½å¤©ç”»åƒURL
         - rakuten_category_id       # æ¥½å¤©ã‚«ãƒ†ã‚´ãƒªID

       amazon:
         - amazon_title              # Amazonå•†å“ã‚¿ã‚¤ãƒˆãƒ«
         - amazon_price              # Amazonä¾¡æ ¼
         - amazon_bullet_points      # Amazonç®‡æ¡æ›¸ã
         - amazon_product_type       # Amazonãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚¿ã‚¤ãƒ—

       qoo10:
         - qoo10_title              # Qoo10ã‚¿ã‚¤ãƒˆãƒ«
         - qoo10_price              # Qoo10ä¾¡æ ¼
         - qoo10_description_kr     # éŸ“å›½èªèª¬æ˜

       yahoo:
         - yahoo_name               # Yahooå•†å“å
         - yahoo_price              # Yahooä¾¡æ ¼
         - yahoo_description        # Yahooèª¬æ˜æ–‡
   ```

2. **ãƒ‡ãƒ¼ã‚¿çµ±åˆå‡¦ç†**
   ```typescript
   // src/processors/mall-data-integrator.ts

   interface MallProductData {
     masterCode: string;

     // å…±é€šå±æ€§
     common: {
       internalSku: string;
       janCode?: string;
       basePrice: number;
       stock: number;
     };

     // ãƒ¢ãƒ¼ãƒ«åˆ¥å±æ€§
     mallSpecific: {
       rakuten?: RakutenProductAttributes;
       amazon?: AmazonProductAttributes;
       qoo10?: Qoo10ProductAttributes;
       yahoo?: YahooProductAttributes;
     };
   }

   class MallDataIntegrator {
     // å„ãƒ¢ãƒ¼ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆ
     async integrateProductData(
       masterCode: string
     ): Promise<MallProductData> {
       const rakutenData = await this.fetchRakutenData(masterCode);
       const amazonData = await this.fetchAmazonData(masterCode);
       const qoo10Data = await this.fetchQoo10Data(masterCode);
       const yahooData = await this.fetchYahooData(masterCode);

       return {
         masterCode,
         common: this.extractCommonAttributes([
           rakutenData,
           amazonData,
           qoo10Data,
           yahooData,
         ]),
         mallSpecific: {
           rakuten: rakutenData,
           amazon: amazonData,
           qoo10: qoo10Data,
           yahoo: yahooData,
         },
       };
     }

     // å…±é€šå±æ€§ã®æŠ½å‡ºï¼ˆå„ªå…ˆé †ä½ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãï¼‰
     private extractCommonAttributes(
       mallDataList: MallProductData[]
     ): CommonAttributes {
       // å„ªå…ˆé †ä½: Amazon > æ¥½å¤© > Yahoo > Qoo10
       // ã¾ãŸã¯ã€æœ€é«˜ä¾¡æ ¼ã€æœ€ä½ä¾¡æ ¼ãªã©ã®ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨
     }
   }
   ```

#### 2.2.3 åœ¨åº«ç®¡ç†ã®è¤‡é›‘æ€§

**èª²é¡Œ:**
- ãƒ¢ãƒ¼ãƒ«åˆ¥åœ¨åº« vs çµ±åˆåœ¨åº«ã®é¸æŠ
- åœ¨åº«å¼•å½“ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
- å®‰å…¨åœ¨åº«ã®ç¢ºä¿

**åœ¨åº«ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³:**

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ¢ãƒ¼ãƒ«åˆ¥åœ¨åº«ç®¡ç†**
```yaml
inventory:
  mode: mall_specific

  allocation:
    master_code: "MASTER-001"
    total_stock: 100

    # ãƒ¢ãƒ¼ãƒ«åˆ¥å‰²ã‚Šå½“ã¦
    mall_allocation:
      rakuten: 30
      amazon: 40
      qoo10: 15
      yahoo: 15

    # åœ¨åº«èª¿æ•´ãƒ«ãƒ¼ãƒ«
    rules:
      auto_rebalance: true           # å£²ã‚Œè¡Œãã«å¿œã˜ã¦è‡ªå‹•å†é…åˆ†
      rebalance_interval: daily      # å†é…åˆ†é »åº¦
      safety_stock: 5                # å®‰å…¨åœ¨åº«æ•°
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: çµ±åˆåœ¨åº«ç®¡ç†**
```yaml
inventory:
  mode: unified

  allocation:
    master_code: "MASTER-001"
    total_stock: 100

    # çµ±åˆåœ¨åº«ã‹ã‚‰è‡ªå‹•å¼•å½“
    rules:
      priority_order:                # å„ªå…ˆé †ä½
        - amazon                     # Amazonå„ªå…ˆï¼ˆåˆ©ç›Šç‡é«˜ã„ï¼‰
        - rakuten
        - yahoo
        - qoo10

      buffer_stock: 10               # ãƒãƒƒãƒ•ã‚¡åœ¨åº«
      oversell_protection: true      # å£²ã‚Šè¶Šã—é˜²æ­¢
      sync_interval_minutes: 5       # åŒæœŸé–“éš”
```

**å®Ÿè£…ä¾‹:**
```typescript
// src/services/inventory-allocation-service.ts

type AllocationMode = 'mall_specific' | 'unified';

interface InventoryAllocation {
  masterCode: string;
  totalStock: number;
  mode: AllocationMode;
  mallAllocation?: Record<string, number>;
  rules: AllocationRules;
}

class InventoryAllocationService {
  // åœ¨åº«ã‚’å„ãƒ¢ãƒ¼ãƒ«ã«é…åˆ†
  async allocateStock(
    allocation: InventoryAllocation
  ): Promise<void> {
    if (allocation.mode === 'mall_specific') {
      await this.allocateMallSpecific(allocation);
    } else {
      await this.allocateUnified(allocation);
    }
  }

  // ãƒ¢ãƒ¼ãƒ«åˆ¥åœ¨åº«é…åˆ†
  private async allocateMallSpecific(
    allocation: InventoryAllocation
  ): Promise<void> {
    for (const [mall, stock] of Object.entries(
      allocation.mallAllocation!
    )) {
      await this.updateMallStock(
        allocation.masterCode,
        mall,
        stock
      );
    }
  }

  // çµ±åˆåœ¨åº«ç®¡ç†ï¼ˆå„ªå…ˆé †ä½ãƒ™ãƒ¼ã‚¹ï¼‰
  private async allocateUnified(
    allocation: InventoryAllocation
  ): Promise<void> {
    const availableStock = allocation.totalStock;

    // ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ä¸€å…ƒç®¡ç†
    await this.nextEngineClient.updateStock({
      masterCode: allocation.masterCode,
      stock: availableStock,
      syncToMalls: true,  // å„ãƒ¢ãƒ¼ãƒ«ã«è‡ªå‹•åŒæœŸ
    });
  }

  // åœ¨åº«å†é…åˆ†ï¼ˆå£²ã‚Œè¡Œããƒ™ãƒ¼ã‚¹ï¼‰
  async rebalanceStock(masterCode: string): Promise<void> {
    // å„ãƒ¢ãƒ¼ãƒ«ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const salesData = await this.getSalesData(masterCode);

    // å£²ä¸Šæ¯”ç‡ã«åŸºã¥ã„ã¦åœ¨åº«ã‚’å†é…åˆ†
    const newAllocation = this.calculateOptimalAllocation(
      salesData
    );

    await this.allocateStock(newAllocation);
  }
}
```

#### 2.2.4 ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæˆ¦ç•¥

**èª²é¡Œ:**
æ—¢å­˜ãƒ¢ãƒ¼ãƒ«ã®è†¨å¤§ãªå•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã«ç§»è¡Œã™ã‚‹éš›ã®æˆ¦ç•¥ã€‚

**ç§»è¡Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:**

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: æ®µéšçš„ç§»è¡Œï¼ˆæ¨å¥¨ï¼‰**
```yaml
migration:
  strategy: phased

  phases:
    # Phase 1: ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆå•†å“ï¼ˆ10-20å•†å“ï¼‰
    - phase: 1
      name: "Pilot Migration"
      target_products: 20
      criteria:
        - high_volume_sellers: true
        - simple_variants: true
      duration_days: 7
      validation:
        - data_accuracy_check
        - order_flow_test
        - inventory_sync_test

    # Phase 2: ã‚«ãƒ†ã‚´ãƒªåˆ¥ç§»è¡Œï¼ˆ100-200å•†å“ï¼‰
    - phase: 2
      name: "Category Migration"
      target_categories:
        - "ã‚¢ãƒ‘ãƒ¬ãƒ«"
        - "é›‘è²¨"
      duration_days: 14
      parallel_run: true    # æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ä¸¦è¡Œç¨¼åƒ

    # Phase 3: å…¨å•†å“ç§»è¡Œ
    - phase: 3
      name: "Full Migration"
      target_products: all
      duration_days: 30
      cutover_plan:
        - backup_existing_data
        - execute_migration
        - validate_data
        - switch_to_next_engine
```

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: ä¸€æ‹¬ç§»è¡Œ**
```yaml
migration:
  strategy: big_bang

  preparation:
    # äº‹å‰æº–å‚™æœŸé–“
    - data_cleansing: 30 days
    - mapping_table_creation: 14 days
    - test_migration: 7 days

  execution:
    cutover_date: "2026-02-01"
    cutover_window:
      start: "2026-02-01 00:00:00"
      end: "2026-02-01 06:00:00"

    steps:
      - freeze_mall_orders        # å—æ³¨åœæ­¢
      - export_all_data           # ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      - import_to_next_engine     # ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã¸æŠ•å…¥
      - validate_data             # ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
      - resume_operations         # é‹ç”¨å†é–‹

  rollback_plan:
    trigger_conditions:
      - data_loss_detected
      - critical_errors > 5%
    procedures:
      - restore_from_backup
      - revert_to_mall_systems
```

**ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**
```typescript
// scripts/migration/migrate-from-malls.ts

interface MigrationConfig {
  strategy: 'phased' | 'big_bang';
  sourceData: {
    rakuten: string;    // CSVãƒ‘ã‚¹
    amazon: string;
    qoo10: string;
    yahoo: string;
  };
  mappingTable: string; // ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
  validation: {
    enableDryRun: boolean;
    sampleSize?: number;
  };
}

class MallMigrationService {
  async executeMigration(
    config: MigrationConfig
  ): Promise<MigrationResult> {
    // 1. ãƒ‡ãƒ¼ã‚¿åé›†
    const allMallData = await this.collectMallData(config);

    // 2. ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°
    const cleanedData = await this.cleanseData(allMallData);

    // 3. å•†å“ã‚³ãƒ¼ãƒ‰çµ±ä¸€
    const unifiedData = await this.unifyProductCodes(
      cleanedData,
      config.mappingTable
    );

    // 4. é‡è¤‡æ’é™¤
    const deduplicatedData = await this.deduplicateProducts(
      unifiedData
    );

    // 5. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const validationResult = await this.validateMigrationData(
      deduplicatedData
    );

    if (!validationResult.isValid) {
      throw new Error('Migration data validation failed');
    }

    // 6. Dry Runï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
    if (config.validation.enableDryRun) {
      return await this.executeDryRun(deduplicatedData);
    }

    // 7. æœ¬ç•ªç§»è¡Œå®Ÿè¡Œ
    return await this.executeProductionMigration(
      deduplicatedData
    );
  }

  // ãƒ¢ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®åé›†
  private async collectMallData(
    config: MigrationConfig
  ): Promise<MallData[]> {
    const loaders = {
      rakuten: new RakutenDataLoader(config.sourceData.rakuten),
      amazon: new AmazonDataLoader(config.sourceData.amazon),
      qoo10: new Qoo10DataLoader(config.sourceData.qoo10),
      yahoo: new YahooDataLoader(config.sourceData.yahoo),
    };

    const [rakutenData, amazonData, qoo10Data, yahooData] =
      await Promise.all([
        loaders.rakuten.load(),
        loaders.amazon.load(),
        loaders.qoo10.load(),
        loaders.yahoo.load(),
      ]);

    return [...rakutenData, ...amazonData, ...qoo10Data, ...yahooData];
  }
}
```

#### 2.2.5 ãƒ¢ãƒ¼ãƒ«å›ºæœ‰åˆ¶ç´„ã¸ã®å¯¾å¿œ

**æ¥½å¤©å¸‚å ´**
```yaml
rakuten:
  constraints:
    # RMSåˆ¶ç´„
    - max_product_name_length: 255
    - max_description_length: 10000
    - required_fields:
        - item_number
        - item_name
        - price
        - inventory

    # ã‚«ãƒ†ã‚´ãƒªéšå±¤
    category_hierarchy:
      max_depth: 4
      mapping_required: true

  api_integration:
    # RMS WebService API
    endpoint: "https://api.rms.rakuten.co.jp/"
    auth_method: "license_key"
    rate_limit: 5000 per_day
```

**Amazon**
```yaml
amazon:
  constraints:
    # ã‚»ãƒ©ãƒ¼ã‚»ãƒ³ãƒˆãƒ©ãƒ«åˆ¶ç´„
    - asin_required: true
    - sku_max_length: 40
    - product_type_required: true

    # FBAå¯¾å¿œ
    fba_integration:
      enabled: true
      sync_fba_inventory: true

  api_integration:
    # MWS / SP-API
    endpoint: "https://sellingpartnerapi-fe.amazon.com"
    auth_method: "lwa_oauth2"
    marketplace_id: "A1VC38T7YXB528"  # æ—¥æœ¬
```

**Qoo10**
```yaml
qoo10:
  constraints:
    # Qoo10å›ºæœ‰åˆ¶ç´„
    - product_number_format: numeric
    - multilingual_support:
        - japanese
        - korean
        - english

    # é…é€ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    shipping:
      qxpress_required: true
      overseas_shipping: supported

  api_integration:
    endpoint: "https://api.qoo10.jp/GMKT.INC.Front.QAPIService/"
    auth_method: "api_key"
```

**Yahoo!ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°**
```yaml
yahoo:
  constraints:
    # ã‚¹ãƒˆã‚¢ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼Proåˆ¶ç´„
    - product_id_max_length: 50
    - category_mapping_required: true
    - yahoo_wallet_integration: required

    # PROå¥‘ç´„é™å®šæ©Ÿèƒ½
    pro_features:
      - advanced_analytics
      - api_integration

  api_integration:
    endpoint: "https://circus.shopping.yahooapis.jp/"
    auth_method: "yahoo_id"
```

### 2.3 æ¨å¥¨ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
[æ—¢å­˜ãƒ¢ãƒ¼ãƒ«] â†’ [ãƒ‡ãƒ¼ã‚¿æŠ½å‡º] â†’ [ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°] â†’ [å•†å“ã‚³ãƒ¼ãƒ‰çµ±ä¸€]
                                                            â†“
                                                    [ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«]
                                                            â†“
                                    [ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³å•†å“ãƒã‚¹ã‚¿ãƒ¼] â† [ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
                                                            â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â†“              â†“              â†“              â†“              â†“
                    [æ¥½å¤©å¸‚å ´]      [Amazon]       [Qoo10]    [Yahoo!ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°]
                        â†“              â†“              â†“              â†“
                    [åœ¨åº«åŒæœŸ] â†â”€â”€â”€â”€â”€ [ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³åœ¨åº«ç®¡ç†] â”€â”€â”€â”€â”€â†’ [åœ¨åº«åŒæœŸ]
```

---

## 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 å…¨ä½“æ§‹æˆ

```
~/.claude/skills/next-engine/
â”œâ”€â”€ SKILL.md                    # ã‚¹ã‚­ãƒ«å®šç¾©ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ commands/                   # å®Ÿè¡Œå¯èƒ½ã‚³ãƒãƒ³ãƒ‰
â”‚   â”œâ”€â”€ sync-products.sh        # å•†å“ãƒã‚¹ã‚¿åŒæœŸ
â”‚   â”œâ”€â”€ update-inventory.sh     # åœ¨åº«æ›´æ–°
â”‚   â””â”€â”€ configure-shipping.sh   # é…é€è¨­å®š
â”œâ”€â”€ templates/                  # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ product-config.yaml
â”‚   â”œâ”€â”€ inventory-config.yaml
â”‚   â””â”€â”€ shipping-config.yaml
â”œâ”€â”€ scripts/                    # å®Ÿè£…ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ api-client.ts           # Next Engine API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ product-sync.ts         # å•†å“åŒæœŸå‡¦ç†
â”‚   â”œâ”€â”€ inventory-sync.ts       # åœ¨åº«åŒæœŸå‡¦ç†
â”‚   â””â”€â”€ shipping-sync.ts        # é…é€è¨­å®šåŒæœŸ
â””â”€â”€ lib/
    â”œâ”€â”€ auth.ts                 # èªè¨¼å‡¦ç†
    â”œâ”€â”€ validators.ts           # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    â””â”€â”€ error-handler.ts        # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```

### 2.2 å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
    â†“
è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ (YAML/JSON)
    â†“
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    â†“
Next Engine APIèªè¨¼
    â†“
APIå‘¼ã³å‡ºã—ï¼ˆãƒãƒƒãƒå‡¦ç†ï¼‰
    â†“
çµæœãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
```

---

## 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜

### 3.1 å•†å“ãƒã‚¹ã‚¿è¨­å®š (`product-config.yaml`)

```yaml
# Next Engine APIèªè¨¼æƒ…å ±
api:
  client_id: "${NEXT_ENGINE_CLIENT_ID}"
  client_secret: "${NEXT_ENGINE_CLIENT_SECRET}"
  redirect_uri: "${NEXT_ENGINE_REDIRECT_URI}"
  access_token: "${NEXT_ENGINE_ACCESS_TOKEN}"
  refresh_token: "${NEXT_ENGINE_REFRESH_TOKEN}"

# å•†å“ãƒã‚¹ã‚¿è¨­å®š
products:
  # ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼ˆCSV, JSON, DB ãªã©ï¼‰
  source:
    type: csv
    path: ./data/products.csv
    encoding: utf-8

  # ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©
  mapping:
    product_code: "å•†å“ã‚³ãƒ¼ãƒ‰"
    product_name: "å•†å“å"
    price: "è²©å£²ä¾¡æ ¼"
    stock: "åœ¨åº«æ•°"
    category: "ã‚«ãƒ†ã‚´ãƒª"
    description: "å•†å“èª¬æ˜"

  # æ›´æ–°ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  options:
    update_mode: upsert  # create, update, upsert
    batch_size: 100
    error_handling: skip  # skip, stop, rollback
    dry_run: false

# ãƒ­ã‚°è¨­å®š
logging:
  level: info
  output: ./logs/product-sync.log
```

### 3.2 åœ¨åº«ç®¡ç†è¨­å®š (`inventory-config.yaml`)

```yaml
api:
  client_id: "${NEXT_ENGINE_CLIENT_ID}"
  client_secret: "${NEXT_ENGINE_CLIENT_SECRET}"
  access_token: "${NEXT_ENGINE_ACCESS_TOKEN}"

inventory:
  source:
    type: api  # api, csv, json
    endpoint: "https://your-warehouse-api.com/inventory"
    headers:
      Authorization: "Bearer ${WAREHOUSE_API_TOKEN}"

  # åœ¨åº«åŒæœŸè¨­å®š
  sync:
    schedule: "*/10 * * * *"  # 10åˆ†ã”ã¨
    warehouses:
      - warehouse_id: "WH001"
        name: "æ±äº¬å€‰åº«"
        priority: 1
      - warehouse_id: "WH002"
        name: "å¤§é˜ªå€‰åº«"
        priority: 2

  # ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
  alerts:
    low_stock_threshold: 10
    notification:
      - type: email
        recipients: ["admin@example.com"]
      - type: slack
        webhook: "${SLACK_WEBHOOK_URL}"

  options:
    batch_size: 200
    sync_interval_minutes: 10
```

### 3.3 ç™ºé€ãƒ»é…é€è¨­å®š (`shipping-config.yaml`)

```yaml
api:
  client_id: "${NEXT_ENGINE_CLIENT_ID}"
  client_secret: "${NEXT_ENGINE_CLIENT_SECRET}"
  access_token: "${NEXT_ENGINE_ACCESS_TOKEN}"

shipping:
  # é…é€æ¥­è€…ãƒãƒƒãƒ”ãƒ³ã‚°
  carriers:
    - carrier_id: "yamato"
      name: "ãƒ¤ãƒãƒˆé‹è¼¸"
      api_key: "${YAMATO_API_KEY}"
      tracking_url: "https://toi.kuronekoyamato.co.jp/cgi-bin/tneko"
    - carrier_id: "sagawa"
      name: "ä½å·æ€¥ä¾¿"
      api_key: "${SAGAWA_API_KEY}"
      tracking_url: "https://k2k.sagawa-exp.co.jp/p/web/okurijosearch.do"

  # é…é€æ–¹æ³•ãƒãƒƒãƒ”ãƒ³ã‚°
  shipping_methods:
    - next_engine_id: "001"
      carrier_id: "yamato"
      service_type: "å®…æ€¥ä¾¿"
      default_size: "60"
    - next_engine_id: "002"
      carrier_id: "yamato"
      service_type: "ãƒã‚³ãƒã‚¹"

  # è‡ªå‹•å‡¦ç†è¨­å®š
  automation:
    auto_issue_slip: true
    auto_register_tracking: true
    notification_on_shipped: true
```

---

## 4. API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­è¨ˆ

### 4.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

```typescript
// scripts/api-client.ts

interface NextEngineAuth {
  client_id: string;
  client_secret: string;
  redirect_uri: string;
  access_token?: string;
  refresh_token?: string;
}

class NextEngineClient {
  private auth: NextEngineAuth;
  private baseUrl = 'https://api.next-engine.org/api_v1_';

  constructor(auth: NextEngineAuth) {
    this.auth = auth;
  }

  // OAuthèªè¨¼
  async authenticate(): Promise<void> {
    // ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ãƒ»ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†
  }

  // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå…±é€šå‡¦ç†
  async request(endpoint: string, params?: Record<string, any>): Promise<any> {
    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    // ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
  }
}
```

### 4.2 ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| æ©Ÿèƒ½ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ç”¨é€” |
|------|--------------|------|
| å•†å“æ¤œç´¢ | `receiveorder/product/search` | å•†å“æƒ…å ±å–å¾— |
| å•†å“æ›´æ–° | `receiveorder/product/update` | å•†å“æƒ…å ±æ›´æ–° |
| åœ¨åº«æ¤œç´¢ | `receiveorder/stock/search` | åœ¨åº«æƒ…å ±å–å¾— |
| åœ¨åº«æ›´æ–° | `receiveorder/stock/update` | åœ¨åº«æ•°æ›´æ–° |
| å—æ³¨æ¤œç´¢ | `receiveorder/receiveorder/search` | å—æ³¨æƒ…å ±å–å¾— |
| å—æ³¨æ›´æ–° | `receiveorder/receiveorder/update` | å—æ³¨æƒ…å ±æ›´æ–° |

---

## 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 5.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡

```typescript
// lib/error-handler.ts

export class NextEngineError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 500,
    public details?: Record<string, unknown>
  ) {
    super(message);
  }
}

// APIèªè¨¼ã‚¨ãƒ©ãƒ¼
export class AuthenticationError extends NextEngineError {
  constructor(message = 'Authentication failed') {
    super(message, 'AUTH_ERROR', 401);
  }
}

// ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼
export class RateLimitError extends NextEngineError {
  constructor(retryAfter?: number) {
    super('Rate limit exceeded', 'RATE_LIMIT', 429, { retryAfter });
  }
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
export class ValidationError extends NextEngineError {
  constructor(message: string, details?: Record<string, unknown>) {
    super(message, 'VALIDATION_ERROR', 400, details);
  }
}

// API ã‚¨ãƒ©ãƒ¼
export class ApiError extends NextEngineError {
  constructor(message: string, statusCode: number, details?: Record<string, unknown>) {
    super(message, 'API_ERROR', statusCode, details);
  }
}
```

### 5.2 ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥

```typescript
// lib/retry.ts

interface RetryOptions {
  maxRetries: number;
  backoffMs: number;
  maxBackoffMs: number;
}

async function withRetry<T>(
  fn: () => Promise<T>,
  options: RetryOptions = {
    maxRetries: 3,
    backoffMs: 1000,
    maxBackoffMs: 10000,
  }
): Promise<T> {
  let lastError: Error;

  for (let attempt = 0; attempt <= options.maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;

      // ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã‹ãƒã‚§ãƒƒã‚¯
      if (!isRetryable(error)) {
        throw error;
      }

      // æœ€å¾Œã®è©¦è¡Œãªã‚‰ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼
      if (attempt === options.maxRetries) {
        break;
      }

      // ãƒãƒƒã‚¯ã‚ªãƒ•å¾…æ©Ÿ
      const backoff = Math.min(
        options.backoffMs * Math.pow(2, attempt),
        options.maxBackoffMs
      );
      await sleep(backoff);
    }
  }

  throw lastError!;
}
```

---

## 6. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### 6.1 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// lib/validators.ts
import { z } from 'zod';

// APIèªè¨¼ã‚¹ã‚­ãƒ¼ãƒ
const apiAuthSchema = z.object({
  client_id: z.string().min(1, 'Client ID is required'),
  client_secret: z.string().min(1, 'Client Secret is required'),
  redirect_uri: z.string().url('Invalid redirect URI'),
  access_token: z.string().optional(),
  refresh_token: z.string().optional(),
});

// å•†å“è¨­å®šã‚¹ã‚­ãƒ¼ãƒ
const productConfigSchema = z.object({
  api: apiAuthSchema,
  products: z.object({
    source: z.object({
      type: z.enum(['csv', 'json', 'db']),
      path: z.string(),
      encoding: z.string().default('utf-8'),
    }),
    mapping: z.record(z.string()),
    options: z.object({
      update_mode: z.enum(['create', 'update', 'upsert']),
      batch_size: z.number().int().positive().max(1000),
      error_handling: z.enum(['skip', 'stop', 'rollback']),
      dry_run: z.boolean().default(false),
    }),
  }),
  logging: z.object({
    level: z.enum(['debug', 'info', 'warn', 'error']),
    output: z.string(),
  }).optional(),
});

export type ProductConfig = z.infer<typeof productConfigSchema>;

export function validateProductConfig(config: unknown): ProductConfig {
  return productConfigSchema.parse(config);
}
```

---

## 7. å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰è¨­è¨ˆ

### 7.1 å•†å“ãƒã‚¹ã‚¿åŒæœŸã‚³ãƒãƒ³ãƒ‰

```bash
# ~/.claude/skills/next-engine/commands/sync-products.sh

#!/bin/bash

# ä½¿ç”¨æ–¹æ³•:
# /user:next-engine:sync-products [config-file]

CONFIG_FILE=${1:-"./product-config.yaml"}

echo "ğŸš€ Next Engine å•†å“ãƒã‚¹ã‚¿åŒæœŸé–‹å§‹"
echo "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: $CONFIG_FILE"

# TypeScriptã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
npx tsx ~/.claude/skills/next-engine/scripts/product-sync.ts \
  --config "$CONFIG_FILE" \
  --verbose

echo "âœ… åŒæœŸå®Œäº†"
```

### 7.2 åœ¨åº«æ›´æ–°ã‚³ãƒãƒ³ãƒ‰

```bash
# ~/.claude/skills/next-engine/commands/update-inventory.sh

#!/bin/bash

CONFIG_FILE=${1:-"./inventory-config.yaml"}

echo "ğŸ“¦ Next Engine åœ¨åº«æ›´æ–°é–‹å§‹"
echo "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: $CONFIG_FILE"

npx tsx ~/.claude/skills/next-engine/scripts/inventory-sync.ts \
  --config "$CONFIG_FILE" \
  --verbose

echo "âœ… åœ¨åº«æ›´æ–°å®Œäº†"
```

### 7.3 é…é€è¨­å®šã‚³ãƒãƒ³ãƒ‰

```bash
# ~/.claude/skills/next-engine/commands/configure-shipping.sh

#!/bin/bash

CONFIG_FILE=${1:-"./shipping-config.yaml"}

echo "ğŸšš Next Engine é…é€è¨­å®šé–‹å§‹"
echo "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: $CONFIG_FILE"

npx tsx ~/.claude/skills/next-engine/scripts/shipping-sync.ts \
  --config "$CONFIG_FILE" \
  --verbose

echo "âœ… é…é€è¨­å®šå®Œäº†"
```

---

## 8. å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆWeek 1-2ï¼‰
- [ ] API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…
- [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- [ ] ãƒ­ã‚®ãƒ³ã‚°å®Ÿè£…

### Phase 2: å•†å“ãƒã‚¹ã‚¿è‡ªå‹•åŒ–ï¼ˆWeek 3ï¼‰
- [ ] å•†å“ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
- [ ] å•†å“ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†
- [ ] å•†å“æ¤œç´¢APIå®Ÿè£…
- [ ] å•†å“æ›´æ–°APIå®Ÿè£…
- [ ] ãƒãƒƒãƒå‡¦ç†å®Ÿè£…

### Phase 3: åœ¨åº«ç®¡ç†è‡ªå‹•åŒ–ï¼ˆWeek 4ï¼‰
- [ ] åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é€£æº
- [ ] åœ¨åº«æ¤œç´¢APIå®Ÿè£…
- [ ] åœ¨åº«æ›´æ–°APIå®Ÿè£…
- [ ] ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½å®Ÿè£…

### Phase 4: ç™ºé€ãƒ»é…é€è‡ªå‹•åŒ–ï¼ˆWeek 5ï¼‰
- [ ] é…é€æ¥­è€…APIé€£æº
- [ ] é€ã‚ŠçŠ¶ç™ºè¡Œæ©Ÿèƒ½
- [ ] è¿½è·¡ç•ªå·ç™»éŒ²æ©Ÿèƒ½
- [ ] é€šçŸ¥æ©Ÿèƒ½å®Ÿè£…

### Phase 5: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆWeek 6ï¼‰
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™
- [ ] é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ä½œæˆ

---

## 9. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 9.1 èªè¨¼æƒ…å ±ç®¡ç†
- API ã‚­ãƒ¼ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
- `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `.gitignore` ã«è¿½åŠ 
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å®Ÿè£…

### 9.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·
- æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ã‚°å‡ºåŠ›ç¦æ­¢
- é€šä¿¡ã¯ HTTPS ã®ã¿
- å€‹äººæƒ…å ±ã®æš—å·åŒ–

### 9.3 æ¨©é™ç®¡ç†
- æœ€å°æ¨©é™ã®åŸå‰‡
- API ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼
- ç›£æŸ»ãƒ­ã‚°ã®è¨˜éŒ²

---

## 10. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ãƒ­ã‚°

### 10.1 ãƒ­ã‚°å‡ºåŠ›ä»•æ§˜

```typescript
// lib/logger.ts

enum LogLevel {
  DEBUG = 'debug',
  INFO = 'info',
  WARN = 'warn',
  ERROR = 'error',
}

interface LogEntry {
  timestamp: string;
  level: LogLevel;
  message: string;
  context?: Record<string, unknown>;
  error?: Error;
}

class Logger {
  constructor(private config: { level: LogLevel; output: string }) {}

  info(message: string, context?: Record<string, unknown>): void {
    this.log(LogLevel.INFO, message, context);
  }

  error(message: string, error?: Error, context?: Record<string, unknown>): void {
    this.log(LogLevel.ERROR, message, context, error);
  }

  private log(
    level: LogLevel,
    message: string,
    context?: Record<string, unknown>,
    error?: Error
  ): void {
    const entry: LogEntry = {
      timestamp: new Date().toISOString(),
      level,
      message,
      context,
      error,
    };

    // ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ› or ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    this.write(entry);
  }
}
```

### 10.2 å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆ

å®Ÿè¡Œå¾Œã«ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚€ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆï¼š

```json
{
  "execution_id": "uuid-v4",
  "started_at": "2026-01-02T12:00:00Z",
  "completed_at": "2026-01-02T12:05:30Z",
  "duration_seconds": 330,
  "status": "success",
  "summary": {
    "total_processed": 1000,
    "success": 980,
    "failed": 20,
    "skipped": 0
  },
  "errors": [
    {
      "line": 45,
      "product_code": "PROD-001",
      "error": "Validation failed: Invalid price"
    }
  ]
}
```

---

## 11. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 11.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

```typescript
// scripts/__tests__/api-client.test.ts
import { describe, it, expect, vi } from 'vitest';
import { NextEngineClient } from '../api-client';

describe('NextEngineClient', () => {
  it('should authenticate successfully', async () => {
    const client = new NextEngineClient({
      client_id: 'test_id',
      client_secret: 'test_secret',
      redirect_uri: 'https://example.com/callback',
    });

    // ãƒ¢ãƒƒã‚¯å®Ÿè£…
    const mockAuth = vi.spyOn(client, 'authenticate');
    mockAuth.mockResolvedValue();

    await client.authenticate();

    expect(mockAuth).toHaveBeenCalled();
  });

  it('should handle rate limiting', async () => {
    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ãƒ†ã‚¹ãƒˆ
  });
});
```

### 11.2 çµ±åˆãƒ†ã‚¹ãƒˆ

```typescript
// scripts/__tests__/integration/product-sync.test.ts
describe('Product Sync Integration', () => {
  it('should sync products from CSV to Next Engine', async () => {
    // E2Eãƒ†ã‚¹ãƒˆï¼ˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒä½¿ç”¨ï¼‰
  });
});
```

---

## 12. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 12.1 ãƒãƒƒãƒå‡¦ç†
- API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é©åˆ‡ãªã‚µã‚¤ã‚ºã«ãƒãƒƒãƒãƒ³ã‚°ï¼ˆ100-200ä»¶ï¼‰
- ä¸¦åˆ—å®Ÿè¡Œæ•°ã®åˆ¶é™ï¼ˆåŒæ™‚5ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ã§ï¼‰
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤º

### 12.2 ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ™‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±ã®ä¿æŒ

### 12.3 ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
- APIåˆ¶é™: 1åˆ†ã‚ãŸã‚Š60ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚ˆã‚‹ãƒªãƒˆãƒ©ã‚¤
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼æ™‚ã®å¾…æ©Ÿå‡¦ç†

---

## 13. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### å¿…è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
1. **SKILL.md** - ã‚¹ã‚­ãƒ«å®šç¾©ã¨ä½¿ç”¨æ–¹æ³•
2. **API_REFERENCE.md** - API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
3. **CONFIG_GUIDE.md** - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰
4. **TROUBLESHOOTING.md** - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
5. **CHANGELOG.md** - å¤‰æ›´å±¥æ­´

---

## 14. å‚è€ƒè³‡æ–™

- [Next Engine Developer Network](https://developer.next-engine.com/)
- [Next Engine API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§](https://developer.next-engine.com/api)
- [Next Engine API ä»•æ§˜ï¼ˆã‚¹ãƒˆãƒƒã‚¯ã‚¯ãƒ«ãƒ¼ï¼‰](https://knowledge.stockcrew.co.jp/help/apialignment/next-engine/attention)
- [ãƒ­ã‚¸ã‚¯ãƒ© - Next Engine API å¾¹åº•è§£èª¬](https://logikura.jp/columns/thorough-explanation-of-next-engine-api/)

---

**ä½œæˆæ—¥**: 2026-01-02
**ä½œæˆè€…**: Claude Code
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
